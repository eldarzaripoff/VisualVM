# Задача "Исследование JVM через VisualVM"
## Скрин вывода на консоль результата работы программы в IDEA:
![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/20462d27-208c-4644-a03e-08c1899f2cce)  
Исходя из выведенных на консоль результатов работы программы, её работу можно поделить на 2 блока - загрузку классов и создание объектов. Сначала будут продемонстрированы скрины, а в конце каждого блока будут расписаны причины поведения того или иного показателя в VisualVM. 

## Первая выполняющаяся операция, выведенная на консоль - 16:42:38.279349400: loading io.vertx  
В этот момент произошёл скачок нагрузки на ЦПУ, достигший своего пика:  

![CPU16-42-38](https://github.com/eldarzaripoff/VisualVM/assets/105818236/dea00fc8-7546-4bdf-82b2-de797307e1be)  

а также увеличение итогового количества загруженных классов:  

![Classes16-42-38](https://github.com/eldarzaripoff/VisualVM/assets/105818236/fdef9dee-52a4-427a-bcd3-f31c5cfad998)  

Количество используемой памяти кучи в этот момент уменьшилось с 12 582 512 b до 12 455 504:  

![Heap16-42-38](https://github.com/eldarzaripoff/VisualVM/assets/105818236/8bf9818f-df78-4233-81a7-184385646cdc)  

В тот же момент наблюдается первый значительный скачок используемой памяти Metaspace:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/151fb13e-bfd0-4788-88e7-3e15623af68d)  

Количество потоков в этот момент осталось неизменным и останется таковым до конца работы программы.  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/0a9552d8-ee95-4fde-902b-bcfa0b27bb92)

## Завершение загрузки классов io.vertx - 16:42:39.224979300: loaded 529 classes  
По итогу загрузки классов, нагрузка на ЦПУ начала спадать и в конечном итоге достигнет нуля.  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/07ce6d7c-a775-4b93-abba-d692abcc169c)  

Количество подгруженных классов вырастет примерно на то же значение, которое вывелось на консоль:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/94bea4ee-6f5c-4223-bcbc-712ea6a4d2cb)  

Это отразилось на количестве используемой памяти в куче - оно увеличилось больше чем в 2 раза:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/297461b9-80b5-48d0-9b0a-a4811be82f15)  

В то же время используемая память в Metaspace численно осталась неизменной:

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/8a369874-3ae7-423c-b8a4-26dd5d966f1c)  

## Следующая загрузка классов - 16:42:42.230218300: loading io.netty  

Нагрузка на ЦПУ в этот раз увеличилась куда больше, так как возросло количество подгружаемых классов.  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/228cf2a9-bfc4-4fb3-96a8-6f7f13a9dcad)

На данный момент количество классов начинается увеличиваться:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/263ee4da-65d8-41fe-9821-6f8e4d7e966a)  

В этот момент размер занимаемой кучи достигает первого своего значительного количества и составляет половину от всей выделенной памяти:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/bdd45c42-04ea-42a0-8868-7402d8c67b08)  

Параллельно увеличивается и размер занимаемого Metaspace:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/77362031-3de2-4a22-a068-06f763a72a69)  

## Завершение загрузки классов - io.netty 16:42:44.276298900: loaded 2117 classes 
На момент завершения загрузки классов нагрузка на ЦПУ вновь начала близиться к нулю:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/13566f90-cce9-43a7-b86a-6594e7125a00)  

О завершении загрузки классов также свидетельствует график количества классов, который в момент окончания загрузки перестаёт расти вверх и начинает двигаться в горизонтальном направлении:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/97d9084d-79ef-4390-8161-acd28aeb44ab)  

Подобно предыдущему графику график Metaspace также принимает горизонтальное положение:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/52a08b1a-2a71-4f68-8d3e-ace1208a0c6b)  

Количество занимаемой памяти в куче к моменту завершения загрузки классов сократилось:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/178ec8bd-0729-476a-89d3-3553a9c7cc35)  

## Последняя загрузка классов - 16:42:47.276798: loading org.springframework  

Снова виден рост нагрузки на ЦПУ:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/edccc860-373d-4c77-a606-01650c68a82c)  

Наблюдается рост количества классов:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/0d6acf0b-e7d1-4377-9439-bd810da344ca)  

И увеличение занимаемого Metaspace:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/d9511299-1e9d-453e-88b6-97bf8f61a282)  

Хоть и график нагрузки ЦПУ и не показал очевидного роста GC activity, сработал сборщик мусора, вследствие чего размер выделенной и используемой памяти резко сократилось, что видно на скрине:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/f98618c4-588d-4ab7-96f2-74bf747e683d)  

## Завершение загрузки классов - 16:42:47.944682600: loaded 869 classes  
На момент завершения загрузки классов нагрузка на ЦПУ достигла пика, после чего начала убывать:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/74bc7018-abee-4868-89b6-4270e0dd3879)

По графику классов видно, что их количество достигло пика:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/b1d6423e-dc55-45ee-9a67-1ece424199a5)  

Размер занимаемого heap так же достигает своего пика к моменту завершения загрузки классов, хотя на графике это не так очевидно:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/742bc331-a094-4ba4-977d-1ff9802876a8)  

В то же время размер Metaspace остаётся неизменным:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/ad1ab11f-29d6-46e1-9a75-2e09f3dd0539)  

## Итоги загрузки классов:  
Исходя из графиков можно выделить следующие тенденции:

1. При загрузке классов нагрузка на ЦПУ увеличивается. Это происходит потому, что при загрузке классов происходит множество операций, таких как чтение файлов с кодом классов, проверка зависимостей, компиляция и т.д. Все эти операции требуют процессорной мощности для выполнения, что приводит к увеличению нагрузки на ЦПУ.  
2. Рост используемой памяти в куче при этом незначителен, так как её память предназначена, в первую очередь для объектов, которые создавались в небольших количествах и удалялись, вследствие чего было видно пологое падение используемой памяти в куче в ходе выполнения загрузки классов.  
3. Самый интенсивный рост используемой памяти испытал на себе Metaspace, так как эта область памяти  используется для хранения информации о классах, методах, переменных и другой информации о программе. Каждый раз, когда загружается новый класс, необходимо выделить память в Metaspace для хранения этой информации.  

## Первый этап создания объектов - 16:42:50.945838800: creating 5000000 objects  
Округлим до 16:42:51.

На момент скриншота видно возрастание нагрузки на ЦПУ: 

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/3109c252-d9dc-4823-8c57-c9f4f678bc4c)  

Количество классов с момента завершения загрузки классов и до момента завершения работы программы останется неизменным:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/b3408ec2-86c6-4291-91d7-625bb1a21e9c)  

Наблюдается рост размера используемого Metaspace:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/40de559d-7b8d-414e-b038-afd3cf58cb10)  

Вследствие создания новых объектов видно кратное увеличение использования памяти кучи и выделение дополнительной памяти:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/7e4b61d2-4870-47cc-80de-c98b5c270554)  

## Завершение создания объектов - 16:42:51.549681100: created  
Округлим до 16:42:52.  

О завершении создания объектов говорит снижение нагрузки на ЦПУ до 0%:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/41880a61-d721-4821-8525-53b047ad2cd8)  

Об этом же свидетельствует окончание потребления дополнительного пространства в куче:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/b576482c-0fd1-4d18-b4be-2c6dfe84f4b2)  

Линия потребления Metaspace приняла своё финальное горизонтальное положение и не изменится до конца работы программы:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/e6856a45-c6bf-4fb7-8ea8-0e189b05c308)  

## Второй этап создания объектов - 16:42:54.549794500: creating 5000000 objects  

На момент начала создания новых объектов график нагрузки ЦПУ начинает движение по возрастающей:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/c592516b-7a90-48f3-97a8-5c753b44bf3b)  

Об этом же говорит и график использования Heap:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/62005a9f-5fd3-435d-8e01-4f02a3948cc4)  

## Завершение создания объектов - 16:42:55.091795600: created  

Нагрузка на ЦПУ достигает пика, после чего начинает резко падать:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/bb9520b4-c073-49db-9c47-654e9a0e9ada)  

В завершении загрузки можно убедиться по графику Heap, принявшему горизонтальное положение:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/a28827f6-0f00-4317-b1ec-c54e572058e2)  

## Последний этап создания объектов - 16:42:58.688828300: created

Линия нагрузки ЦПУ достигла пика в момент завершения создания объектов, после чего она начнет резко падать:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/f8254d8d-7987-4216-9c6c-832744651b28)  

Программа завершила создание объектов, а это значит , что пространство в куче больше не занимается:  

![image](https://github.com/eldarzaripoff/VisualVM/assets/105818236/2591f723-7aab-41c9-9496-0715382a9780)

## Итоги создания объектов:  

1. Создание объектов требует немалой нагрузки на ЦПУ, численно сопоставимой и моментами превосходящей, чем при загрузке классов.
2. Изменение занимаемого пространства Metaspace связано лишь с внесением метаданных о новых классах. Когда загрузка новых метаданных не требуется, Metaspace остаётся неизменным.
3. Созданные объекты сохраняются в куче, что наглядно видно по графикам, в которых количество занимаемой памяти в куче с каждым разом увеличивается кратно.





















